
import os.path
from os.path import join as pjoin

import pytest

from pyarrow._pyarrow_cpp_tests import get_cpp_tests


def inject_cpp_tests(ns):
    """
    Inject C++ tests as Python functions into namespace `ns` (a dict).
    """
    for case in get_cpp_tests():

        def wrapper(case=case):
            case()
        wrapper.__name__ = wrapper.__qualname__ = case.name
        wrapper.__module__ = ns['__name__']
        if 'numpy' in case.name:
            wrapper = pytest.mark.numpy(wrapper)
        elif 'pandas' in case.name:
            wrapper = pytest.mark.pandas(wrapper)
        ns[case.name] = wrapper


inject_cpp_tests(globals())


def test_pyarrow_include():

    source = os.path.dirname(os.path.abspath(__file__))
    pyarrow_dir = pjoin(source, '..')
    pyarrow_include = pjoin(pyarrow_dir, 'include')
    pyarrow_cpp_include = pjoin(pyarrow_include, 'arrow', 'python')

    assert os.path.exists(pyarrow_include)
    assert os.path.exists(pyarrow_cpp_include)
