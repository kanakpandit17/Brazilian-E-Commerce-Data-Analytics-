"""Module with examples from the tutorial section of the docs"""
import os
from gitdb.test.lib import TestBase
from gitdb import IStream
from gitdb.db import LooseObjectDB

from io import BytesIO


class TestExamples(TestBase):

    def test_base(self):
        ldb = LooseObjectDB(os.path.join(self.gitrepopath, 'objects'))

        for sha1 in ldb.sha_iter():
            oinfo = ldb.info(sha1)
            ostream = ldb.stream(sha1)
            assert oinfo[:3] == ostream[:3]

            assert len(ostream.read()) == ostream.size
            assert ldb.has_object(oinfo.binsha)
        try:
            del(ostream)
            del(oinfo)
        except UnboundLocalError:
            pass

        data = b"my data"
        istream = IStream("blob", len(data), BytesIO(data))

        assert istream.binsha is None
        ldb.store(istream)
        assert len(istream.binsha) == 20
        assert ldb.has_object(istream.binsha)
